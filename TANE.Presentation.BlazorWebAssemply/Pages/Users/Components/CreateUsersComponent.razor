@page "/users/create"
@using TANE.Domain.Entities
@using TANE.Presentation.BlazorWebAssemply.Configuration
@inject HttpClient Http

<h3>Opret ny bruger</h3>

<RadzenTemplateForm TItem="User" Data=@User Submit="@OnSubmit" InvalidSubmit=@OnInvalidSubmit>
    <RadzenStack Gap="1rem" Class="rz-p-sm-12">

        <!-- E-mail -->
        <RadzenFormField Text="E-mail" Variant="@ThemeConfig.FormVariant">
            <ChildContent>
                <RadzenTextBox Name="Email" @bind-Value="User.Email" Type="Email" Style="width:100%" />
            </ChildContent>
            <Helper>
                <RadzenRequiredValidator Component="Email" Text="E-mail skal udfyldes." />
                <RadzenEmailValidator Component="Email" Text="Indtast en gyldig e-mail." />
            </Helper>
        </RadzenFormField>

        <!-- Token -->
        <RadzenFormField Text="Token" Variant="@ThemeConfig.FormVariant">
            <ChildContent>
                <RadzenPassword Name="Token" @bind-Value="User.Token" Style="width:100%" />
            </ChildContent>
            <Helper>
                <RadzenRequiredValidator Component="Token" Text="Password skal udfyldes." />
                <RadzenRegexValidator
                    Component="Token"
                    Pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*\W).{8,}$"
                    Text="Password skal være mindst 8 tegn langt, indeholde mindst 1 stort bogstav, 1 lille bogstav, 1 tal og 1 specialtegn." />
            </Helper>
        </RadzenFormField>

        <!-- Refresh Token -->
        <RadzenFormField Text="Bekræft password" Variant="@ThemeConfig.FormVariant">
            <ChildContent>
                <RadzenPassword Name="RefreshToken" @bind-Value="User.RefreshToken" Style="width:100%" />
            </ChildContent>
            <Helper>
                <RadzenRequiredValidator Component="RefreshToken" Text="Bekræft dit password." />
                <RadzenCompareValidator Component="RefreshToken" CompareTo="Token" Text="Passwords skal være ens." />
            </Helper>
        </RadzenFormField>

        <RadzenButton ButtonType="ButtonType.Submit" Text="Opret bruger" Style="margin-top:1rem" />

    </RadzenStack>
</RadzenTemplateForm>

@code {
    public User User { get; set; } = new User();

    // Variant fra Radzen (hvis du bruger det samme)
    Variant variant = Variant.Flat;

    // OnSubmit får modellen ind – samme instans som User
    void OnSubmit(User model) => Console.WriteLine(
            $"E-mail: {User.Email}\n" +
            $"Roles: {User.Roles}\n" +
            $"Token: {User.Token}\n" +
            $"Refresh Token: {User.RefreshToken}\n" +
            $"Expiration: {User.Expiration}"
        );

    void OnInvalidSubmit(FormInvalidSubmitEventArgs args)
    {
        // evt. log eller vis fejlbesked
    }
}
