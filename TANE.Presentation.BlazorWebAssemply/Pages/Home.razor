@inject CustomStateProvider AuthStateProvider

@page "/"
@using TANE.Domain.Entities

<PageTitle>Home</PageTitle>

<h1>Hello, world!</h1>

Welcome to your new app.

@* Eksempel på kun at vise ting hvis man er logget ind *@
<AuthorizeView>
    <Authorized>
        <p>Welcome back, @AuthStateProvider.CurrentUser.Email</p>
        <p>@AuthStateProvider.CurrentUser.Expiration.ToLocalTime().ToLongTimeString()</p>
        <p>@DateTime.Now</p>
    </Authorized>
    <NotAuthorized>
        <p>Please log in to access your account.</p>
    </NotAuthorized>
    <Authorizing>
        <p>Checking auth state...</p>
    </Authorizing>
</AuthorizeView>

@code{
    protected override async Task OnInitializedAsync()
    {
        if (AuthStateProvider.CurrentUser != null && AuthStateProvider.CurrentUser.Expiration.ToLocalTime() < DateTime.Now)
        {
            await AuthStateProvider.RefreshTokenAsync();
        }
    }
}
