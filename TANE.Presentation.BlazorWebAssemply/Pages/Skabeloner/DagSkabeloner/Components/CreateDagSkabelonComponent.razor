@using TANE.Application.Groups.DagSkabeloner.Commands.Interfaces
@using TANE.Application.Groups.DagSkabeloner.Queries.Interfaces
@using TANE.Domain.Entities
@using TANE.Persistence.Repositories
@using TANE.Presentation.BlazorWebAssemply.Configuration
@using TANE.Application.Dtos.Skabeloner
@using TANE.Application.RepositoryInterfaces
@inject CustomStateProvider AuthStateProvider
@inject NavigationManager NavigationManager
@inject NotificationService NotificationService
@inject ICreateDagSkabelon CreateDagSkabelon

<div class="rz-p-0 rz-p-md-12">
    <h4>Opret Ny Dag Skabelon</h4>
    <RadzenTemplateForm TItem="DagSkabelon" Data=@Skabelon Submit=@OnSubmit InvalidSubmit=@OnInvalidSubmit>
        <RadzenStack Gap="1rem" class="rz-p-sm-12">

            <RadzenFormField Text="Titel" Variant="@ThemeConfig.FormVariant">
                <ChildContent>
                    <RadzenTextBox Name="Titel" @bind-Value=@Skabelon.Titel />
                </ChildContent>
                <Helper>
                    <RadzenRequiredValidator Component="Titel" Text="Titel skal udfyldes." />
                </Helper>
            </RadzenFormField>


            <RadzenFormField Text="Beskrivelse" Variant="@ThemeConfig.FormVariant">
                <ChildContent>
                    <RadzenTextArea Name="Beskrivelse" @bind-Value="@Skabelon.Beskrivelse" Rows="4" />
                </ChildContent>
                <Helper>
                    <RadzenRequiredValidator Component="Beskrivelse" Text="Beskrivelse skal udfyldes." />
                </Helper>
            </RadzenFormField>

            <RadzenFormField Text="Aktiviteter" Variant="@ThemeConfig.FormVariant">
                <ChildContent>
                    <RadzenTextArea Name="Aktiviteter" @bind-Value="@Skabelon.Aktiviteter" Rows="4"/>
                </ChildContent>
                <Helper>
                    <RadzenRequiredValidator Component="Aktiviteter" Text="Aktiviteter skal udfyldes." />
                </Helper>
            </RadzenFormField>

            <RadzenFormField Text="Måltider" Variant="@ThemeConfig.FormVariant">
                <ChildContent>
                    <RadzenTextArea Name="Måltider" @bind-Value="@Skabelon.Måltider" Rows="4" />
                </ChildContent>
            </RadzenFormField>

            <RadzenFormField Text="Overnatning" Variant="@ThemeConfig.FormVariant">
                <ChildContent>
                    <RadzenTextBox Name="Overnatning" @bind-Value=@Skabelon.Overnatning />
                </ChildContent>
            </RadzenFormField>


            <RadzenButton ButtonType="ButtonType.Submit" Text="Opret" ></RadzenButton>
        </RadzenStack>
    </RadzenTemplateForm>
</div>

@code {
    [Parameter]
    public EventCallback<DagSkabelon> OnSubmitReturn { get; set; }

    public DagSkabelon Skabelon { get; set; } = new DagSkabelon();

    void OnInvalidSubmit( )
    {

    }

    async Task OnSubmit()
    {
        await AuthStateProvider.RefreshTokenAsync(NavigationManager, NotificationService);

        try
        {
            var result = await CreateDagSkabelon.CreateDagSkabelonAsync(Skabelon, AuthStateProvider.CurrentUser.Token);

            NotificationService.Notify(new NotificationMessage()
                {
                    Severity = NotificationSeverity.Success,
                    Summary = "Dag skabelon oprettet",
                    Detail = "Dag skabelon er oprettet."
                });

            if (OnSubmitReturn.HasDelegate)
            {
                await OnSubmitReturn.InvokeAsync(result);
            }
            else
            {
                NavigationManager.NavigateTo("/skabeloner/dag/overview");
            }
        }
        catch (Exception ex)
        {
            NotificationService.Notify(new NotificationMessage()
                {
                    Severity = NotificationSeverity.Error,
                    Summary = "Fejl ved oprettelse",
                    Detail = ex.Message
                });
        }
    }
}

